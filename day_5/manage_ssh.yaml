---
  - name: "Playbook to Manage SSH on our server"
    hosts: localhost
    tasks:

    - name: Set authorized key taken from file
      authorized_key:
        user: centos
        state: present
        key: "{{ lookup('file', '/home/centos/.ssh/id_rsa.pub') }}"

    - name: Ensure that all needed SSH Packages are installed and updated to latest!
      yum:
        name: "{{ packages }}"
      vars:
        packages:
        - openssh
        - openssh-clients
        - openssh-server
    - name: Ensure OpenSSH Server is Started and Running
      service:
        name: sshd
        state: started
    - name: Push out our new SSH config
      template:
        src: sshd_config.j2
        dest: /etc/ssh/sshd_config
        owner: root
        group: root
        mode: '0600'
      vars:
        test_var: "This is a Test"
      notify:
        - Reload SSHD
    handlers:
    - name: Reload SSHD
      service:
        name: sshd
        state: reload
